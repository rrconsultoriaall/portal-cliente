<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Acessar Portal</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; padding: 40px; text-align:center; }
    .card { max-width: 520px; margin: 0 auto; background:#fff; padding: 24px; border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.08); text-align:left; }
    h1 { margin: 0 0 14px; text-align:center; }
    label { display:block; margin: 14px 0 6px; font-weight:600; }
    input { width:100%; padding: 12px; border:1px solid #d9dfe7; border-radius: 10px; font-size:16px; }
    button { width:100%; margin-top: 16px; padding: 12px; border:0; border-radius: 10px; background:#1e40af; color:#fff; font-weight:700; font-size:16px; cursor:pointer; }
    .msg { margin-top: 12px; padding: 10px; border-radius: 10px; display:none; }
    .msg.ok { display:block; background:#ecfdf5; color:#065f46; }
    .msg.err { display:block; background:#fef2f2; color:#991b1b; }
    .hint { margin-top: 10px; color:#6b7280; font-size: 13px; text-align:center; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Acessar Portal</h1>

    <label for="email">Email</label>
    <input id="email" type="email" placeholder="seuemail@dominio.com" autocomplete="email" />

    <label for="password">Senha</label>
    <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" />

    <button id="btn">Entrar</button>

    <div id="msg" class="msg"></div>

    <div class="hint">
      Se der “Invalid login credentials”, confira email/senha e se o usuário está confirmado no Supabase.
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // ✅ Cole suas chaves aqui:
    const SUPABASE_URL = "https://occxmqvoyvmxvaoaxecw.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jY3htcXZveXZteHZhb2F4ZWN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzg4MDMsImV4cCI6MjA4Njg1NDgwM30.lJXhM58PK3ofpZdjeJqdF-C9fV9UL4JRw54cpygWkao";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Base path robusto pra GitHub Pages /portal-cliente/
    const BASE = location.pathname.includes("/portal-cliente/") ? "/portal-cliente/" : "/";

    const $ = (id) => document.getElementById(id);
    const msgBox = $("msg");

    function showMsg(text, ok=false){
      msgBox.textContent = text;
      msgBox.className = "msg " + (ok ? "ok" : "err");
      msgBox.style.display = "block";
    }

    async function goIfAlreadyLogged(){
      const { data } = await supabase.auth.getSession();
      if (data?.session) location.href = BASE + "index.html";
    }
    goIfAlreadyLogged();

    $("btn").addEventListener("click", async () => {
      msgBox.style.display = "none";

      const email = $("email").value.trim();
      const password = $("password").value;

      if(!email || !password){
        showMsg("Preencha email e senha.");
        return;
      }

      $("btn").disabled = true;
      $("btn").textContent = "Entrando...";

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      $("btn").disabled = false;
      $("btn").textContent = "Entrar";

      if(error){
        showMsg(error.message);
        return;
      }

      if(!data?.session){
        showMsg("Não veio sessão. Verifique configurações do Auth no Supabase.");
        return;
      }

      showMsg("Login OK! Indo pro portal…", true);
      setTimeout(() => location.href = BASE + "index.html", 400);
    });
  </script>
</body>
</html>
